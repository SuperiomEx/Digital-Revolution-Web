---
import { getCollection } from 'astro:content';
import ConcursosCTA from '../../components/concursos/ConcursosCTA.astro';
import ConcursosFiltersIsland from '../../components/concursos/ConcursosFiltersIsland.tsx';
import ConcursosHero from '../../components/concursos/ConcursosHero.astro';
import Layout from '../../layouts/Layout.astro';
import '../../styles/components/concursos.css';

// Get all contests from the collection
const allConcursos = await getCollection('concursos');

// Calculate statistics
const activeCount = allConcursos.filter(
  (c) => c.data.status === 'activo',
).length;
const totalParticipants = allConcursos.reduce(
  (acc, c) => acc + (c.data.currentParticipants || 0),
  0,
);
const totalCategories = [...new Set(allConcursos.map((c) => c.data.category))]
  .length;
---

<Layout
  title="Concursos — Digital Revolution Web"
  description="Participa en concursos creativos de la comunidad Digital Revolution. Convocatorias de fotografía, música, arte digital y más."
  image="/og-concursos.jpg"
>
  <div class="concursos-page">
    <!-- Hero Section -->
    <ConcursosHero
      activeCount={activeCount}
      totalParticipants={totalParticipants}
      totalPrizes="$15K+"
      totalCategories={totalCategories}
    />

    <!-- Filters & Grid Section with Search -->
    <ConcursosFiltersIsland client:load concursos={allConcursos} />

    <!-- CTA Section -->
    <ConcursosCTA />
  </div>
</Layout>

<style>
  .concursos-page {
    min-height: 100vh;
    background: var(--palette-background);
    overflow-x: hidden;
  }
</style>
